<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post Exploitation &mdash; pentest-standard 1.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reporting" href="reporting.html" />
    <link rel="prev" title="Exploitation" href="exploitation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="tree.html" class="icon icon-home"> pentest-standard
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">The Penetration Testing Execution Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="preengagement_interactions.html">Pre-engagement Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelligence_gathering.html">Intelligence Gathering</a></li>
<li class="toctree-l1"><a class="reference internal" href="threat_modeling.html">Threat Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="vulnerability_analysis.html">Vulnerability Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploitation.html">Exploitation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Post Exploitation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rules-of-engagement">Rules of Engagement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protect-the-client">Protect the Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protecting-yourself">Protecting Yourself</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#infrastructure-analysis">Infrastructure Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network-configuration">Network Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#interfaces">Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#routing">Routing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dns-servers">DNS Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cached-dns-entries">Cached DNS Entries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proxy-servers">Proxy Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arp-entries">ARP Entries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#network-services">Network Services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#listening-services">Listening Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vpn-connections">VPN Connections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#directory-services">Directory Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#neighbors">Neighbors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pillaging">Pillaging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installed-programs">Installed Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#startup-items">Startup Items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installed-services">Installed Services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#security-services">Security Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-printer-shares">File/Printer Shares</a></li>
<li class="toctree-l4"><a class="reference internal" href="#database-servers">Database Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#directory-servers">Directory Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#name-servers">Name Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deployment-services">Deployment Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#certificate-authority">Certificate Authority</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-code-management-server">Source Code Management Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-host-configuration-server">Dynamic Host Configuration Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#virtualization">Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messaging">Messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-and-management">Monitoring and Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backup-systems">Backup Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#networking-services-radius-tacacs-etc">Networking Services (RADIUS,TACACS..etc)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sensitive-data">Sensitive Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#key-logging">Key-logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#screen-capture">Screen capture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network-traffic-capture">Network traffic capture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#previous-audit-reports">Previous Audit reports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-information">User Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#on-system">On System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#web-browsers">Web Browsers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#im-clients">IM Clients</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#system-configuration">System Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#password-policy">Password Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security-policies">Security Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configured-wireless-networks-and-keys">Configured Wireless Networks and Keys</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#high-value-profile-targets">High Value/Profile Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-exfiltration">Data Exfiltration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mapping-of-all-possible-exfiltration-paths">Mapping of all possible exfiltration paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-exfiltration-paths">Testing exfiltration paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measuring-control-strengths">Measuring control strengths</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#persistence">Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-penetration-into-infrastructure">Further Penetration Into Infrastructure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#from-compromised-system">From Compromised System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thru-compromised-system">Thru Compromised System</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="technical_guidelines.html">PTES Technical Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="media.html">Media</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="tree.html">pentest-standard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="tree.html" class="icon icon-home"></a> &raquo;</li>
      <li>Post Exploitation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/post_exploitation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="post-exploitation">
<span id="id1"></span><h1>Post Exploitation<a class="headerlink" href="#post-exploitation" title="Permalink to this headline">¶</a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>The purpose of the Post-Exploitation phase is to determine the value of
the machine compromised and to maintain control of the machine for later
use. The value of the machine is determined by the sensitivity of the
data stored on it and the machines usefulness in further compromising
the network. The methods described in this phase are meant to help the
tester identify and document sensitive data, identify configuration
settings, communication channels, and relationships with other network
devices that can be used to gain further access to the network, and
setup one or more methods of accessing the machine at a later time. In
cases where these methods differ from the agreed upon Rules of
Engagement, the Rules of Engagement must be followed.</p>
</section>
<section id="rules-of-engagement">
<h2>Rules of Engagement<a class="headerlink" href="#rules-of-engagement" title="Permalink to this headline">¶</a></h2>
<p>The following Rules of Engagement are specific to the Post-Exploitation
phase of a penetration test and are intended to ensure that the client’s
systems are not subjected to unnecessary risk by the (direct or
indirect) actions of the testers and to ensure a mutually agreed
procedure to follow during the post-exploitation phase of the project.</p>
<section id="protect-the-client">
<h3>Protect the Client<a class="headerlink" href="#protect-the-client" title="Permalink to this headline">¶</a></h3>
<p>The following rules are to be used as a guideline of rules to establish
with a client to ensure that the day to day operations and data of the
client are not exposed to risk:</p>
<ul class="simple">
<li><p>Unless previously agreed upon, there will be no modification of
services which the client deems “critical” to their infrastructure.
The purpose of modifying such services would be to demonstrate to the
client how an attacker may:</p>
<ul>
<li><p>Escalate privileges</p></li>
<li><p>Gain access to specific data</p></li>
<li><p>Cause denial of service</p></li>
</ul>
</li>
<li><p>All modifications, including configuration changes, executed against
a system must be documented. After finishing the intended purpose of
the modification, all settings should be returned to their original
positions if possible. The list of changes should be given to the
client after the engagement to allow them to ensure all changes were
properly undone. Changes that could not be returned to their original
positions should be clearly differentiated from changes that were
successfully reversed.</p></li>
<li><p>A detailed list of actions taken against compromised systems must be
kept. The list should include the action taken and the time period in
which it occurred. Upon completion, this list should be included as
an appendix to the final report.</p></li>
<li><p>Any and all private and/or personal user data (including passwords
and system history) uncovered during the course of the penetration
test may be used as leverage to gain further permissions or to
execute other actions related to the test only if the following
conditions are met:</p>
<ul>
<li><p>The client’s Acceptable Use Policy states all systems are owned by
the client and all data stored on those systems are the property
of the client.</p></li>
<li><p>The Acceptable Use Policy states connection to the client’s
network is considered consent for the connected machine to be
searched and analyzed (including all present data and
configurations).</p></li>
<li><p>The client has confirmation that all employees have read and
understand the Acceptable Use Policy.</p></li>
</ul>
</li>
<li><p>Passwords (including those in encrypted form) will not be included in
the final report, or must be masked enough to ensure recipients of
the report cannot recreate or guess the password. This is done to
safeguard the confidentiality of the users the passwords belong to,
as well as to maintain the integrity of the systems they protect.</p></li>
<li><p>Any method or device used to maintain access to compromised systems
and that could affect the proper operation of the system or whose
removal may cause downtime may not be implemented without the prior
written consent of the client.</p></li>
<li><p>Any method or device which is used to maintain access to compromised
systems must employ some form of user authentication such as digital
certificates or login prompts. A reverse connection to a known
controlled system is also acceptable.</p></li>
<li><p>All data gathered by the testers must be encrypted on the systems
used by the testers.</p></li>
<li><p>Any information included in the report that could contain sensitive
data (screenshots, tables, figures) must be sanitized or masked using
techniques that render the data permanently unrecoverable by
recipients of the report.</p></li>
<li><p>All data gathered will be destroyed once the client has accepted the
final report. Method used and proof of destruction will be provided
to the client.</p></li>
<li><p>If data gathered is regulated by any law, the systems used and their
locations will be provided by the client to ensure that the data
collected and processed does not violate any applicable laws. If the
systems will be those of the penetration testing team the data may
not be downloaded and stored on to their systems and only proof of
access will be shown (File Permissions, Record Count, file
names..etc).</p></li>
<li><p>Third party services for password cracking will not be used, nor will
there be sharing of any other type of data with third parties without
the clients prior consent.</p></li>
<li><p>If evidence of a prior compromise is found in the assessed
environment all logs with actions and times recorded during the
assessment by the penetration team will be saved, hashed and provided
to the client. The client can then determine how best to respond to
and handle the incident response.</p></li>
<li><p>No logs should be removed, cleared or modified unless specifically
authorized to do so by the client in the engagement
contract/statement of work. If authorized, the logs must be backed up
prior to any changes.</p></li>
</ul>
</section>
<section id="protecting-yourself">
<h3>Protecting Yourself<a class="headerlink" href="#protecting-yourself" title="Permalink to this headline">¶</a></h3>
<p>Due to the nature of a penetration test, you must ensure that you cover
all your bases when dealing with the client and the tasks you will be
performing. Discuss the following with the client to ensure a clear
understanding of the roles and responsibilities of both client and
provider prior to beginning any work.</p>
<ul class="simple">
<li><p>Ensure that the contract and/or statement of work signed by both the
client and provider states that the actions taken on the systems being
tested are on behalf and in representation of the client.</p></li>
<li><p>Obtain a copy of the security policies that govern user use of
company systems and infrastructure (often referred to as “Acceptable
Use” policies) prior to starting the engagement. Verify that policy
covers:</p>
<ul>
<li><p>Personal use of equipment and storage of personal employee data on
the client systems and ownership and rights on that data.</p></li>
<li><p>Ownership of data stored on company equipment.</p></li>
</ul>
</li>
<li><p>Confirm regulations and laws that govern the data that is managed and
used by the client on their systems and the restrictions imposed on
such data.</p></li>
<li><p>Use full drive encryption for those systems and removable media that
will receive and store client data.</p></li>
<li><p>Discuss and establish with the client the procedures to follow in the
case that a compromise from a third party is found.</p></li>
<li><p>Check for laws concerning the capture and/or storage of audio and
video since the use of this methods in post-exploitation may be
considered a violation of local or country wiretap laws.</p></li>
</ul>
</section>
</section>
<section id="infrastructure-analysis">
<h2>Infrastructure Analysis<a class="headerlink" href="#infrastructure-analysis" title="Permalink to this headline">¶</a></h2>
<section id="network-configuration">
<h3>Network Configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h3>
<p>The network configuration of a compromised machine can be used to
identify additional subnets, network routers, critical servers, name
servers and relationships between machine. This information can be used
to identify additional targets to further penetrate the client’s
network.</p>
<section id="interfaces">
<h4>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h4>
<p>Identify all of the network interfaces on the machine along with their
IP addresses, subnet masks, and gateways. By identifying the interfaces
and settings, networks and services can be prioritized for targeting.</p>
</section>
<section id="routing">
<h4>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h4>
<p>Knowledge of other subnets, filtering or addressing schemes could be
leveraged to escape a segmented network, leading to additional hosts
and/or networks to probe and enumerate. This data could come from a
variety of sources on a particluar host or network including:</p>
<ul class="simple">
<li><p>Interfaces</p></li>
<li><p>Routing tables, including static and dynamic routes</p></li>
<li><p>ARP Tables, NetBios or other network protocols used for service and
host discovery.</p></li>
<li><p>For multi-homed hosts, determine if they are acting as a router.</p></li>
</ul>
</section>
<section id="dns-servers">
<h4>DNS Servers<a class="headerlink" href="#dns-servers" title="Permalink to this headline">¶</a></h4>
<p>Identify all DNS servers in use, by assessing host settings. DNS servers
and information could then be used to develop and execute a plan for
discovering additional hosts and services on the target network. In the
case that a DNS Server is compromised, the DNS database will provide
valueable information about hosts and services that can be used to
prioritize targets for the remainder of the assessment. The modification
and addition of new records could be used to intercept the data of
services depending on DNS.</p>
</section>
<section id="cached-dns-entries">
<h4>Cached DNS Entries<a class="headerlink" href="#cached-dns-entries" title="Permalink to this headline">¶</a></h4>
<p>Identify high value DNS entries in the cache, which may include login
pages for Intranet sites, management interfaces, or external sites.
Cached interfaces provide information of the most recent and most used
host used by the compromised host providing a view of the relations and
interactions of the hosts providing information that could be used to
prioritization of targets for further penetration of the target network
and infrastructure. Modification of cached entries if permitted can be
used to capture authentication credential, authentication tokens or to
gain further information on services used by the compromised hosts
leading to further penetration of the target network.</p>
</section>
<section id="proxy-servers">
<h4>Proxy Servers<a class="headerlink" href="#proxy-servers" title="Permalink to this headline">¶</a></h4>
<p>Identify network and application level proxy servers. Proxy servers make
good targets when in enterprise-wide use by the client. In the case of
application proxies, it may be possible to identify, modify and/or
monitor the flow of traffic, or the traffic itself. Proxy attacks are
often an effective means to show impact and risk to the customer.</p>
</section>
<section id="arp-entries">
<h4>ARP Entries<a class="headerlink" href="#arp-entries" title="Permalink to this headline">¶</a></h4>
<p>Enumerate cached and static ARP table entries, which can reveal other
hosts that interact with the compromised machine. Static ARP entries may
represent critical machines. If the scope of the assessment allows for
intercepting and modifying ARP entries, it is simple to show the
possibility of disrupting, monitoring, or compromising a service in a
manner that is usually not detected or protected against.</p>
</section>
</section>
<section id="network-services">
<h3>Network Services<a class="headerlink" href="#network-services" title="Permalink to this headline">¶</a></h3>
<section id="listening-services">
<h4>Listening Services<a class="headerlink" href="#listening-services" title="Permalink to this headline">¶</a></h4>
<p>Identify all the network services offered by the target machine. This
may lead to the discovery of services not identified by initial scanning
as well as the discovery of other machines and networks. The
identification of services not shown in scanning can also provide
information on possible filtering and control systems implemented in the
network and/or host. In addition, the tester may be able to leverage
these services to compromise other machines. Most operating system
include a method of identifying TCP and UDP connections made to and from
the machine. By checking both connections to and from a compromised
machine it is possible to find relationships that were previously
unknown. As well as the host the service should also be considered, this
may reveal services listening on non-standard ports and indicate trust
relationships such as keyless authentication for SSH.</p>
</section>
<section id="vpn-connections">
<h4>VPN Connections<a class="headerlink" href="#vpn-connections" title="Permalink to this headline">¶</a></h4>
<p>All VPN connections into and out of the target machine or network should
be identified. Outbound connections can provide paths into new systems
which may have not previously been identified. Both inbound and outbound
can identify new systems and possible business relationships. VPN
connections often bypass firewalls and intrusion detection/prevention
systems due to their inability to decrypt or inspect encrypted traffic.
This fact makes VPNs ideal to launch attacks through. Any new targets
should be verified as in scope before launching attacks against them.
The presence of VPN client or server connections on the target host may
also provide access to credentials previously not known that could be
used to target other hosts and services.</p>
</section>
<section id="directory-services">
<h4>Directory Services<a class="headerlink" href="#directory-services" title="Permalink to this headline">¶</a></h4>
<p>A targeted host running directory services may provide an opportunity to
enumerate user accounts, hosts and/or services that can be used in
additional attacks or provide additional targets that may not have been
previously discovered in the vulnerability analysis phase. Additionally,
the details of users found in directory services could be used for
Social Engineering and phishing campaign attacks, thus providing a
possible higher success rate.</p>
</section>
<section id="neighbors">
<h4>Neighbors<a class="headerlink" href="#neighbors" title="Permalink to this headline">¶</a></h4>
<p>In todays network many services and operating systems use a number of
protocols for neighbor discovery in an effort make the access of
services, troubleshooting and configuration more convenient. Protocols
vary depending on the type of target host. Networking equipment may use
protocols like CDP (Cisco Discovery Protocol) and LLDP (Link Layer
Discovery Protocol) to identify systems, configurations and other
details to hosts directly connected to them or present in the same
subnet. Similarly, desktop and server operating systems may use
protocols like mDNS (Multicast Domain Name Service) and NetBios to find
details of hosts and services in the same subnet.</p>
</section>
</section>
</section>
<section id="pillaging">
<h2>Pillaging<a class="headerlink" href="#pillaging" title="Permalink to this headline">¶</a></h2>
<p>Pillaging refers to obtaining information (i.e. files containing
personal information, credit card information, passwords, etc.) from
targeted hosts relevant to the goals defined in the pre-assessment
phase. This information could be obtained for the purpose of satisfying
goals or as part of the pivoting process to gain further access to the
network. The location of this data will vary depending on the type of
data, role of the host and other circumstances. Knowledge and basic
familiarity with commonly used applications, server software and
middleware is very important, as most applications store their data in
many different formats and locations. Special tools may be necessary to
obtain, extract or read the targeted data from some systems.</p>
<section id="installed-programs">
<h3>Installed Programs<a class="headerlink" href="#installed-programs" title="Permalink to this headline">¶</a></h3>
<section id="startup-items">
<h4>Startup Items<a class="headerlink" href="#startup-items" title="Permalink to this headline">¶</a></h4>
<p>Most systems will have applications that can run at system startup or at
user logon that can provide information about the purpose of the system,
software and services it interacts with. This information may reveal
potential countermeasures that could be in place that may hinder further
exploitation of a target network and it’s systems (e.g. HIDS/HIPS,
Application Whitelisting, FIM). Information that should be gathered
includes:</p>
<ul class="simple">
<li><p>List of the applications and their associated versions installed on
the system.</p></li>
<li><p>List of operating system updates applied to the system.</p></li>
</ul>
</section>
</section>
<section id="installed-services">
<h3>Installed Services<a class="headerlink" href="#installed-services" title="Permalink to this headline">¶</a></h3>
<p>Services on a particular host may serve the host itself, or other hosts
in the target network. It is necessary to create a profile of each
targeted host, noting the configuration of these services, their
purpose, and how they may potentially be used to achieve assessment
goals or further penetrate the network.</p>
<section id="security-services">
<h4>Security Services<a class="headerlink" href="#security-services" title="Permalink to this headline">¶</a></h4>
<p>Security services comprise the software designed to keep an attacker out
of systems, and keep data safe. These include, but are not limited to
network firewalls, host-based firewalls, IDS/IPS, HIDS/HIPS and
anti-virus. Identifying any security services on a single targeted host
gives an idea of what to expect when targeting other machines in the
network. It also gives an idea of what alerts may have been triggered
during the test, which can be discussed with the client during the
project debrief, and may result in updates to Security Policies, UAC,
SELinux, IPSec, windows security templates, or other security
rulesets/configurations.</p>
</section>
<section id="file-printer-shares">
<h4>File/Printer Shares<a class="headerlink" href="#file-printer-shares" title="Permalink to this headline">¶</a></h4>
<p>File and print servers often contain targeted data or provide an
opportunity to further penetrate the target network and hosts. The
information that should be targeted includes:</p>
<ul class="simple">
<li><p>Shares offered by File Servers - Any file shares offered by target
systems should be examined. Even just the names and comments of
shares can leak important information about the names of internal
applications or projects (i.e. if only “Fred” and “Christine” have
access to the “Accounting” folder, perhaps they are both accounting
employees).</p></li>
<li><p>Access Control Lists and permissions for shares. - From the client
side, if it is possible to connect to the share, then it should be
checked to see if the connection is read/only or read/write. Remember
that if a share contains directories then different permissions may
apply to different directories. From the server side both server
configuration and file/directory permissions should be examined.</p></li>
<li><p>File share file and content listings</p></li>
<li><p>Identify files of interest from the file share listings. Look for
interesting or targeted items such as:</p>
<ul>
<li><p>Source Code</p></li>
<li><p>Backups</p></li>
<li><p>Installation Files</p></li>
<li><p>Confidential Data (financial data in spreadsheets, bank reports in
TXT/PDF, password files, etc.)</p></li>
</ul>
</li>
<li><p>Place trojans or autorun files - Using clever naming, or by mimicking
naming conventions already in use, users can be encouraged to execute
these payloads, allowing the tester to further penetrate the network.
If file server logs can be obtained, specific users may even be
targeted.</p></li>
</ul>
</section>
<section id="database-servers">
<h4>Database Servers<a class="headerlink" href="#database-servers" title="Permalink to this headline">¶</a></h4>
<p>Databases contain a wealth of information that may be targeted in an
assessment.</p>
<ul class="simple">
<li><p>Databases - A list of database names can help the assessor to
determine the purpose of the database and the types of data the
database may contain. In an environment with many databases, this
will help in prioritizing targets.</p></li>
<li><p>Tables - Table names and metadata, such as comments, column names and
types can also help the assessor choose targets and find targeted
data.</p></li>
<li><p>Table Content, row count for regulated content</p></li>
<li><p>Columns - It is possible in many databases to search all column names
of all tables with a single command. This can be leveraged to find
targeted data (e.g. If credit card data is targeted on an Oracle
database, try executing <em>select * from all_tab_columns where name
= ‘%CCN%’;</em>.</p></li>
<li><p>Database and Table Permissions</p></li>
<li><p>Database Users, Passwords, Groups and Roles</p></li>
</ul>
<p>The information hosted on databases can be also be used to show risk,
achieve assessment goals, determine configuration and function of
services or to further penetrate a client network and hosts.</p>
</section>
<section id="directory-servers">
<h4>Directory Servers<a class="headerlink" href="#directory-servers" title="Permalink to this headline">¶</a></h4>
<p>The main goals of a directory service is to provide information to
services and hosts for reference or/and authentication. The compromise
of this service can allow the control of all hosts that depend on the
service and well as provide information that could be used to further an
attack. Information to look for in a directory service are:</p>
<ul class="simple">
<li><p>List of objects (Users, passwords, Machines..etc)</p></li>
<li><p>Connections to the system</p></li>
<li><p>Identification of protocols and security level</p></li>
</ul>
</section>
<section id="name-servers">
<h4>Name Servers<a class="headerlink" href="#name-servers" title="Permalink to this headline">¶</a></h4>
<p>Name server provide resolution to host and services depending on the
types of records it servers. Enumeration of records and controls can
provide a list of targets and services to prioritize and attack to
further penetrate a clients network and hosts. The ability to modify and
add records can be use to show risk of denial of services as well as aid
in the interception of traffic and information on a customer network.</p>
</section>
<section id="deployment-services">
<h4>Deployment Services<a class="headerlink" href="#deployment-services" title="Permalink to this headline">¶</a></h4>
<p>Identification of deployment services allows for the access and
enumeration of:</p>
<ul class="simple">
<li><p>Unattended answer files</p></li>
<li><p>Permission on files</p></li>
<li><p>Updates included</p></li>
<li><p>Applications and versions</p></li>
</ul>
<p>This information can be used to further penetrate a client network and
hosts. The ability to modify the repositories and configuration of the
service allows for</p>
<ul class="simple">
<li><p>Backdoor installation</p></li>
<li><p>Modification of services to make them vulnerable to attack</p></li>
</ul>
</section>
<section id="certificate-authority">
<h4>Certificate Authority<a class="headerlink" href="#certificate-authority" title="Permalink to this headline">¶</a></h4>
<p>Identification of Certificate Authority services on a compromised client
host will allow for the access to</p>
<ul class="simple">
<li><p>Root CA</p></li>
<li><p>Code Signing Certificates</p></li>
<li><p>Encryption and Signing Certificates</p></li>
</ul>
<p>Control of the service will also allow for the</p>
<ul class="simple">
<li><p>Creation of new certificates for several tasks</p></li>
<li><p>Revocation of certificates</p></li>
<li><p>Modification of the Certificate Revocation List</p></li>
<li><p>Insertion of Root CA Certificate</p></li>
</ul>
<p>The control of the services shows risk and allows for the compromise of
data and services on a client’s network and hosts.</p>
</section>
<section id="source-code-management-server">
<h4>Source Code Management Server<a class="headerlink" href="#source-code-management-server" title="Permalink to this headline">¶</a></h4>
<p>Identification of source code management systems via by the service
running on the compromised host or the client part of the service
provides the opportunity for:</p>
<ul class="simple">
<li><p>Enumerate projects - The project names can give away sensitive
information on company projects.</p></li>
<li><p>Verify access to source code files</p></li>
<li><p>Modify source code files - If it is allowed in scope then modifying
source code proves that an attacker could make changes that would
affect the system</p></li>
<li><p>Enumerate developers - Developers details can be use for social
engineering attacks as well as as inputs for attacking other areas of
the system</p></li>
<li><p>Enumerate configuration</p></li>
</ul>
</section>
<section id="dynamic-host-configuration-server">
<h4>Dynamic Host Configuration Server<a class="headerlink" href="#dynamic-host-configuration-server" title="Permalink to this headline">¶</a></h4>
<p>Identification of dynamic host configuration service or use of the
service by the compromised host allows for:</p>
<ul class="simple">
<li><p>Enumeration leases given</p></li>
<li><p>Enumeration configuration</p></li>
<li><p>Enumeration Options</p></li>
<li><p>Modification of configuration</p></li>
<li><p>Consumption of all leases</p></li>
</ul>
<p>The control of the service can be used to show risk of denial of service
and for use in man in the middle attacks of hosts and services on the
compromised network.</p>
</section>
<section id="virtualization">
<h4>Virtualization<a class="headerlink" href="#virtualization" title="Permalink to this headline">¶</a></h4>
<p>Identification virtualization services or client software allow for:</p>
<ul class="simple">
<li><p>Enumerate Virtual Machines (name, configurations, OS)</p></li>
<li><p>Enumerate passwords and digital certificates for administration
systems.</p></li>
<li><p>Enumerate virtualization software configuration</p></li>
<li><p>Configuration of Hosts</p></li>
<li><p>Show risk of denial of service with control of VM state</p></li>
<li><p>Access to data hosted on VM’s</p></li>
<li><p>Interception of traffic of virtual hosts or services hosted on the
compromised host</p></li>
</ul>
</section>
<section id="messaging">
<h4>Messaging<a class="headerlink" href="#messaging" title="Permalink to this headline">¶</a></h4>
<p>Identification of services or client software for messaging provides the
opportunity to</p>
<ul class="simple">
<li><p>Identify Directory Services</p></li>
<li><p>Compromise of credentials</p></li>
<li><p>Access to confidential information</p></li>
<li><p>Identification of hosts on the network</p></li>
<li><p>System and business relationships</p></li>
</ul>
<p>All of this information and actions can be used to show risk and to
further penetrate a client’s network and hosts.</p>
</section>
<section id="monitoring-and-management">
<h4>Monitoring and Management<a class="headerlink" href="#monitoring-and-management" title="Permalink to this headline">¶</a></h4>
<p>Identification of services or client software for the purpose of
monitoring and/or management may provide identification of additional
servers and services on the target network, in addition the
configuration parameters gained may provide access to other targets host
and to determine what actions performed by the tester can be detected by
the client. Some services to look for:</p>
<ul class="simple">
<li><p>SNMP (Simple Network Management Protocol)</p></li>
<li><p>Syslog</p></li>
</ul>
<p>Some Management Services and Software to look for to gain credentials,
identify host and gain access to other services may be:</p>
<ul class="simple">
<li><p>SSH Server/Client</p></li>
<li><p>Telnet Server/Client</p></li>
<li><p>RDP (Remote Desktop Protocol) Client</p></li>
<li><p>Terminal Server</p></li>
<li><p>Virtual Environment Management Software</p></li>
</ul>
</section>
<section id="backup-systems">
<h4>Backup Systems<a class="headerlink" href="#backup-systems" title="Permalink to this headline">¶</a></h4>
<p>Identification of services or client software for the purpose of backing
up data provide a great opportunity to an attacker since these system
require access to the data and systems they need to backup providing an
attacker:</p>
<ul class="simple">
<li><p>Enumeration of hosts and systems</p></li>
<li><p>Enumeration of services</p></li>
<li><p>Credentials to host and/or services</p></li>
<li><p>Access to backup data</p></li>
</ul>
<p>The information gained from the service can be used to show risk to the
confidentiality, integrity and access tot he system and their
information. Access to the backups can also provide opportunity to
introduce miss configuration, vulnerable software or backdoors in to the
clients systems.</p>
</section>
<section id="networking-services-radius-tacacs-etc">
<h4>Networking Services (RADIUS,TACACS..etc)<a class="headerlink" href="#networking-services-radius-tacacs-etc" title="Permalink to this headline">¶</a></h4>
<p>Identification of services or use of networking services allows for the:</p>
<ul class="simple">
<li><p>Enumeration of users</p></li>
<li><p>Enumeration of hosts and systems</p></li>
<li><p>Compromise of credentials</p></li>
<li><p>Show risk of denial of service if alternate methods are not present</p></li>
</ul>
</section>
</section>
<section id="sensitive-data">
<h3>Sensitive Data<a class="headerlink" href="#sensitive-data" title="Permalink to this headline">¶</a></h3>
<section id="key-logging">
<h4>Key-logging<a class="headerlink" href="#key-logging" title="Permalink to this headline">¶</a></h4>
<p>By monitoring key strokes it is possible to detect sensitive information
including passwords and PII - Don’t know what the legality of this is if
the user is say chatting on private IM while also using company
software, anyone know? If the company says that all data on the network
can be monitored then this should be ok. If the second bullet point in
Protect Yourself is present and it states that use of equipment can be
monitored and no personal use is permitted yes, if policy does not cover
personal user or ownership of data, no. It should be extended to cover
Network also.</p>
</section>
<section id="screen-capture">
<h4>Screen capture<a class="headerlink" href="#screen-capture" title="Permalink to this headline">¶</a></h4>
<p>Screen capture can be use to show evidence of compromise as well as
access to information that can shown on the screen and access thru other
means is not possible. Great care should be taken with the data
collected thru screen capture so as to nor show private data of
employees of customers of the client.</p>
</section>
<section id="network-traffic-capture">
<h4>Network traffic capture<a class="headerlink" href="#network-traffic-capture" title="Permalink to this headline">¶</a></h4>
<p>Network traffic capture can be used depending on the controls on the
network and medium used for capture can be used to:</p>
<ul class="simple">
<li><p>Identify hosts on the network</p></li>
<li><p>Intercept data</p></li>
<li><p>Identify services</p></li>
<li><p>Identify relations between hosts in the network</p></li>
<li><p>Capture of credentials</p></li>
</ul>
<p>Care should be taken to only capture traffic covered under the scope of
the engagement and that the information captured does not fall under the
control of local laws like the capture of Voice Over IP calls.
Information retained and shown should be filtered so as to protect
client’s customer and/or employee personal and confidential data.</p>
</section>
<section id="previous-audit-reports">
<h4>Previous Audit reports<a class="headerlink" href="#previous-audit-reports" title="Permalink to this headline">¶</a></h4>
</section>
</section>
<section id="user-information">
<h3>User Information<a class="headerlink" href="#user-information" title="Permalink to this headline">¶</a></h3>
<p>In this section the main focus is on the information present on the
target system related to user accounts either present on the system or
that have connected remotely and have left some trace that the personnel
performing the assessment can gather and analyze for further penetration
or provide the desired goal of the assessment.</p>
<section id="on-system">
<h4>On System<a class="headerlink" href="#on-system" title="Permalink to this headline">¶</a></h4>
<p>General information that can be gather on a compromised system are:</p>
<ul class="simple">
<li><p>History files - History files store recent commands the user has
executed. Reading through these can reveal system configuration
information, important applications, data locations and other system
*sensitive information.</p></li>
<li><p>Encryption Keys (SSH, PGP/GPG)</p></li>
<li><p>Interesting Documents (.doc/x, .xls/x , password.*) - Users often
store passwords and other sensitive information in clear text
documents. These can be located in two ways, either searching through
file names for interesting words, such as password.txt, or searching
through the documents themselves. Indexing services can help with
this, for example the Linux locate database.</p></li>
<li><p>User specific application configuration parameters</p></li>
<li><p>Individual Application History (MRU Windows only, history files..etc)</p></li>
<li><p>Enumerate removable media</p></li>
<li><p>Enumerate network shares / domain permission (gpresult)</p></li>
</ul>
</section>
<section id="web-browsers">
<h4>Web Browsers<a class="headerlink" href="#web-browsers" title="Permalink to this headline">¶</a></h4>
<p>Information that can be gathered from web browsers that can be use to
identify other hosts and systems as well as provide information to
further penetrate a client’s network and hosts are:</p>
<ul class="simple">
<li><p>Browser History</p></li>
<li><p>Bookmarks</p></li>
<li><p>Download History</p></li>
<li><p>Credentials</p></li>
<li><p>Proxies</p></li>
<li><p>Plugins/Extensions</p></li>
</ul>
<p>Great care should be taken that only data in scope for the engagement is
capture since the information from a web browser may contain client’s
employee confidential and private data. This data should be filtered
from the data returned and report.</p>
</section>
<section id="im-clients">
<h4>IM Clients<a class="headerlink" href="#im-clients" title="Permalink to this headline">¶</a></h4>
<p>Information that can be gathered from IM Clients on a compromised system
is:</p>
<ul class="simple">
<li><p>Enumerate Account Configuration (User, Password, Server, Proxy)</p></li>
<li><p>Chat Logs</p></li>
</ul>
<p>Great care should be taken that only data in scope for the engagement is
capture since the information from a web browser may contain client’s
employee confidential and private data. This data should be filtered
from the data returned and report.</p>
</section>
</section>
<section id="system-configuration">
<h3>System Configuration<a class="headerlink" href="#system-configuration" title="Permalink to this headline">¶</a></h3>
<section id="password-policy">
<h4>Password Policy<a class="headerlink" href="#password-policy" title="Permalink to this headline">¶</a></h4>
<p>By enumerating the systems password policy the ability to brute force
and crack passwords becomes much more efficient, for example knowing
that the minimum password length is 8 characters you can remove any word
less than 8 characters from a dictionary.</p>
</section>
<section id="security-policies">
<h4>Security Policies<a class="headerlink" href="#security-policies" title="Permalink to this headline">¶</a></h4>
</section>
<section id="configured-wireless-networks-and-keys">
<h4>Configured Wireless Networks and Keys<a class="headerlink" href="#configured-wireless-networks-and-keys" title="Permalink to this headline">¶</a></h4>
<p>By finding the targets wireless information it becomes possible to
launch physical attacks through the companies wifi when on site. It can
also allow a fake AP to be set up to lure targets to connect when away
from site.</p>
</section>
</section>
</section>
<section id="high-value-profile-targets">
<h2>High Value/Profile Targets<a class="headerlink" href="#high-value-profile-targets" title="Permalink to this headline">¶</a></h2>
<p>High value/profile targets can be identified and further expanded from
the targets identified in the pre-engagement meetings thru the analysis
of the data gathered from the compromised systems and the interactions
of those systems and the services that run on them This view of the the
operation and interactions of these high value/profile targets helps in
the identification and measurement of of impact that can be gained to
the business do to the data and processes and to the overall integrity
of the client’s infrastructure and services.</p>
</section>
<section id="data-exfiltration">
<h2>Data Exfiltration<a class="headerlink" href="#data-exfiltration" title="Permalink to this headline">¶</a></h2>
<section id="mapping-of-all-possible-exfiltration-paths">
<h3>Mapping of all possible exfiltration paths<a class="headerlink" href="#mapping-of-all-possible-exfiltration-paths" title="Permalink to this headline">¶</a></h3>
<p>From each of the areas where access has been achieved, a full
exfiltration paths should be created. This includes secondary and
tertiary means of getting to the outside world (through different
accessible subnetc, etc). Once the mapping is provided, the actual
exfiltration testing should be commenced.</p>
</section>
<section id="testing-exfiltration-paths">
<h3>Testing exfiltration paths<a class="headerlink" href="#testing-exfiltration-paths" title="Permalink to this headline">¶</a></h3>
<p>Per exfiltration paths mapping, data should be exfiltrated from the
organization being tested. This should already be covered in the
<a class="reference external" href="Pre-engagement">Pre-engagement</a> scoping and adequate infrastructure
should have been setup which adheres to the customer’s acceptable
engagement policy (i.e. data being exfiltrated is usually exfiltrated to
a server in the full control of the tester, and will access and
ownership right to the tested organization). The exfiltration itself
should simulate real-world exfiltration strategies used by the threat
actors that correspond to the <a class="reference external" href="ThreatModelingStandard">Threat Modeling
Standard</a> relevant for the organization
(i.e. if criminal mostly then “standard” exfiltration using a staging
area inside the network where data is archived inside zip/7z encrypted
files and then sent to FTP/HTTP servers on the Internet, if a more
sophisticated threat actor then using means that simulate such
strategies and tactics used for exfiltration).</p>
</section>
<section id="measuring-control-strengths">
<h3>Measuring control strengths<a class="headerlink" href="#measuring-control-strengths" title="Permalink to this headline">¶</a></h3>
<p>When performing exfiltration testing, the main goal of the test is to
see whether the current controls for detecting and blocking sensitive
information from leaving the organization actually work, as well as
exercise the response teams if anything has been detected in terms of
how they react to such alerts and how are the events being investigated
and mitigated.</p>
</section>
</section>
<section id="persistence">
<h2>Persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Installation of backdoor that requires authentication.</p></li>
<li><p>Installation and/or modification of services to connect back to
system. User and complex password should be used as a minimum; use of
certificates or cryptographic keys is preferred where possible. (SSH,
ncat, RDP). Reverse connections limited to a single IP may be used.</p></li>
<li><p>Creation of alternate accounts with complex passwords.</p></li>
<li><p>When possible backdoor must survive reboots.</p></li>
</ul>
</section>
<section id="further-penetration-into-infrastructure">
<h2>Further Penetration Into Infrastructure<a class="headerlink" href="#further-penetration-into-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>Pivoting is the action in which the tester will use his presence of on
the compromised system to further enumerate and gain access to other
systems on the client’s infrastructure. This action can be executed from
the compromised host it self using local resourced or tools uploaded to
the compromised system.</p>
<section id="from-compromised-system">
<h3>From Compromised System<a class="headerlink" href="#from-compromised-system" title="Permalink to this headline">¶</a></h3>
<p>Actions that can be taken from a compromised system:</p>
<ul class="simple">
<li><p>Upload tools</p></li>
<li><p>Use local system tools</p></li>
<li><p>ARP Scan</p></li>
<li><p>Ping Sweep</p></li>
<li><p>DNS Enumeration of internal network</p></li>
<li><p>Directory Services Enumeration</p></li>
<li><p>Brute force attacks</p></li>
<li><p>Enumeration and Management thru Management Protocols and compromised
credentials (WinRM, WMI, SMB, SNMP..etc)</p></li>
<li><p>Abuse of compromised credentials and keys (Webpages, Databases..etc)</p></li>
<li><p>Execute Remote Exploits</p></li>
</ul>
<p>The action that will be executed will depend on the information needed
to show specific risk and/or further penetrating the client’s network
and hosts. Regular planning sessions are recommended to re-evaluate the
information gather and decide the best approach to continue the post
exploitation until the set goals are meet.</p>
</section>
<section id="thru-compromised-system">
<h3>Thru Compromised System<a class="headerlink" href="#thru-compromised-system" title="Permalink to this headline">¶</a></h3>
<p>Actions that can be taken thru a compromised system:</p>
<ul class="simple">
<li><p>Port Forwarding</p></li>
<li><p>Proxy to internal network (SSH)</p></li>
<li><p>VPN to internal network</p></li>
<li><p>Execute Remote Exploit</p></li>
<li><p>Abuse of compromised credentials and keys (Webpages, Databases..etc)</p></li>
</ul>
<p>The action that will be executed will depend on the information needed
to show specific risk and/or further penetrating the client’s network
and hosts. Regular planning sessions are recommended to re-evaluate the
information gather and decide the best approach to continue the post
exploitation until the set goals are meet.</p>
</section>
</section>
<section id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h2>
<p>The cleanup process covers the requirements for cleaning up systems once
the penetration test has been completed. This will include all user
accounts and binaries used during the test.</p>
<ul class="simple">
<li><p>Remove all executable, scripts and temporary file from a compromised
system. If possible use secure delete method for removing the files
and folders.</p></li>
<li><p>Return to original values system settings and application
configuration parameters if they where modified during the
assessment.</p></li>
<li><p>Remove all backdoors and/or rootkits installed.</p></li>
<li><p>Remove any user accounts created for connecting back to compromise
systems.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="exploitation.html" class="btn btn-neutral float-left" title="Exploitation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reporting.html" class="btn btn-neutral float-right" title="Reporting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, The PTES Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>